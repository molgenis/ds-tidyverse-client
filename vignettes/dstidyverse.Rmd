---
title: "Using tidyverse within DataSHIELD"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Create resources}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---




```r
library(dsTidyverseClient)
```

## Overview
dsTidyVerseClient is the DataSHIELD implementation of selected functions from the Tidyverse. Most of these functions are from `dplyr`, with some planned implementations for functions from `purrr` and `tidyr`.

As long as not potentially disclosing, all functionality from the Tidyverse functions has been preserved. The main argument which is normally passed to `...` in Tidyverse functions is passed as a list to the argument `tidy_select`.

To illustrate the useage of these functions, we use DSLite which creates a virtual DataSHIELD session.

## Set up environment

```r
install.packages("DSLite")
#> Error in install.packages : Updating loaded packages
install.packages(c("dsBase", "dsBaseClient"), repos = "https://cran.obiba.org/")
#> Error in install.packages : Updating loaded packages
devtools::install_github("molgenis/dsTidyverse")
devtools::install_github("molgenis/dsTidyverseClient")
require(DSLite)
require(dsBase)
require(dsBaseClient)
require(dsTidyverse)
require(dsTidyverseClient)
data("mtcars")
dslite.server <- newDSLiteServer(tables=list(mtcars=mtcars))
data("logindata.dslite.cnsim")
logindata.dslite.cnsim <- logindata.dslite.cnsim %>%
  mutate(table = "mtcars")
dslite.server$config(defaultDSConfiguration(include=c("dsBase", "dsTidyverse")))
dslite.server$assignMethod("selectDS", "selectDS")
dslite.server$assignMethod("renameDS", "renameDS")
conns <- datashield.login(logindata.dslite.cnsim[1, ], assign=TRUE)
```

## Functions
Currently 3 functions are implements: `ds.select`, `ds.rename` and `ds.mutate`.

### Select
ds.select implements all the flexibility of dplyr::select in subsetting columns. This includes:
(i) ability to pass unquoted column names which are evaluated as columns of .data
(ii) ability to use tidyselect helper functions, such as `contains`.

For example:

#### Subset columns by name

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(mpg, disp, wt), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "mpg"  "disp" "wt"
```
#### Specify column to exclude

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(!mpg), newobj = "test")
ds.colnames("test")
#> $sim1
#>  [1] "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
```
#### Specify range of columns

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(mpg:drat), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "mpg"  "cyl"  "disp" "hp"   "drat"
```
#### Match by first letter

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(starts_with('m')), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "mpg"
```
#### Match by last letter

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(ends_with('m')), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "am"
```
#### Pattern matching

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(matches('[aeiou]')), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "disp" "drat" "qsec" "am"   "gear" "carb"
```
#### Multiple conditions with '&'

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(starts_with('c') & ends_with('b')), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "carb"
```
#### Multiple conditions with '|'

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(starts_with('c') | ends_with('b')), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "cyl"  "carb"
```
#### Rename columns on the fly with '='

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.select(df.name = "mtcars", tidy_select = list(test = mpg), newobj = "test")
ds.colnames("test")
#> $sim1
#> [1] "test"
```

#### Rename

```r
ds.colnames("mtcars")
#> $sim1
#>  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear" "carb"
ds.rename(df.name = "mtcars", tidy_select = list(effiency = mpg, power = hp), newobj = "test")
ds.colnames("test")
#> $sim1
#>  [1] "effiency" "cyl"      "disp"     "power"    "drat"     "wt"       "qsec"    
#>  [8] "vs"       "am"       "gear"     "carb"
```
